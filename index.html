<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>IntuBlade US Sales Heatmap</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- D3 + TopoJSON -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0f0f10;
      --text:#ffffff;
      --muted:#a9a9ad;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:'Roboto',sans-serif;}
    #map{height:100vh;width:100%;background:var(--bg);}
    .map-title{
      position:absolute;top:16px;left:50%;transform:translateX(-50%);
      padding:12px 20px;background:rgba(22,22,24,0.9);color:var(--text);
      border-radius:999px;z-index:1000;font-size:20px;font-weight:700;letter-spacing:.3px;
      box-shadow:0 8px 24px rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(6px);-webkit-backdrop-filter: blur(6px);
    }
    .leaflet-popup-content-wrapper,.leaflet-popup-tip{
      background:rgba(22,22,24,0.96);color:var(--text);border:1px solid rgba(255,255,255,.06);
    }
    /* Glow pane: neon effect */
    .leaflet-pane.glow-pane svg path {
      mix-blend-mode: screen;
      filter:
        drop-shadow(0 0 6px rgba(255,150,0,0.55))
        drop-shadow(0 0 14px rgba(255,180,0,0.42))
        drop-shadow(0 0 28px rgba(255,210,0,0.32));
    }
    .leaflet-pane.outline-pane svg path { mix-blend-mode: normal; }
    .leaflet-control-attribution{
      background:rgba(22,22,24,0.8) !important;color:var(--muted) !important;
      border:1px solid rgba(255,255,255,.06) !important;border-radius:6px !important;padding:2px 6px !important;
    }
  </style>
</head>
<body>
  <div class="map-title">IntuBlade US Sales Heatmap</div>
  <div id="map"></div>

  <script>
    // Base Map
    var map = L.map('map', {
      zoomControl: false, scrollWheelZoom: false, doubleClickZoom: false,
      touchZoom: false, boxZoom: false, keyboard: false, minZoom: 4, maxZoom: 4
    }).setView([39.8283, -98.5795], 4);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '© OpenStreetMap contributors © CARTO', subdomains: 'abcd', maxZoom: 19
    }).addTo(map);

    L.control.scale({ position: 'bottomleft', imperial: true, maxWidth: 200 }).addTo(map);

    // Panes for layered look
    map.createPane('glowPane');   map.getPane('glowPane').classList.add('glow-pane');   map.getPane('glowPane').style.zIndex = 410;
    map.createPane('outlinePane');map.getPane('outlinePane').classList.add('outline-pane');map.getPane('outlinePane').style.zIndex = 420;

    // Obfuscated qualitative tiers
    const TIER_LABELS = {5:'Anchor',4:'Strong',3:'Established',2:'Growing',1:'Emerging',0:'—'};
    const stateTier = {
      // 5
      NY:5, OK:5,
      // 4
      GA:4, MA:4, LA:4, TX:4, FL:4,
      // 3
      NC:3, VA:3, OH:3, NE:3, WV:3, IN:3, MO:3, UT:3, CA:3, AZ:3, DC:3, WI:3,
      // 2
      PA:2, NH:2, SC:2,
      // 1
      NM:1, CO:1, TN:1, ME:1, VT:1, IA:1, CT:1, KS:1, ND:1, NV:1, MI:1, IL:1, OR:1, AK:1, MS:1
    };
    function getTier(postal){ return stateTier.hasOwnProperty(postal) ? stateTier[postal] : 0; }
    function fillRGBAForTier(t){
      switch(t){
        case 5: return 'rgba(255,170,20,0.95)'; // brightest
        case 4: return 'rgba(255,150, 8,0.88)';
        case 3: return 'rgba(255,135, 4,0.78)';
        case 2: return 'rgba(255,120, 0,0.60)';
        case 1: return 'rgba(255,120, 0,0.28)'; // faint
        default:return 'rgba(255,255,255,0.00)'; // invisible
      }
    }
    const fipsToPostal = {
      1:"AL",2:"AK",4:"AZ",5:"AR",6:"CA",8:"CO",9:"CT",10:"DE",11:"DC",12:"FL",13:"GA",
      15:"HI",16:"ID",17:"IL",18:"IN",19:"IA",20:"KS",21:"KY",22:"LA",23:"ME",24:"MD",
      25:"MA",26:"MI",27:"MN",28:"MS",29:"MO",30:"MT",31:"NE",32:"NV",33:"NH",34:"NJ",
      35:"NM",36:"NY",37:"NC",38:"ND",39:"OH",40:"OK",41:"OR",42:"PA",44:"RI",45:"SC",
      46:"SD",47:"TN",48:"TX",49:"UT",50:"VT",51:"VA",53:"WA",54:"WV",55:"WI",56:"WY"
    };

    d3.json('https://unpkg.com/us-atlas@3/states-10m.json').then(function(us){
      const statesGeo = topojson.feature(us, us.objects.states);

      // Glow layer
      const glowLayer = L.geoJSON(statesGeo, {
        style: function(feature){
          const postal = fipsToPostal[feature.id];
          const tier = getTier(postal);
          return {
            pane: 'glowPane',
            fillColor: fillRGBAForTier(tier),
            fillOpacity: 1,
            weight: 0,
            color: 'transparent',
            opacity: 0
          };
        }
      }).addTo(map);

      // Outline layer + tooltip
      const outlineLayer = L.geoJSON(statesGeo, {
        style: { pane:'outlinePane', fill:false, weight:1.4, color:'#000000', opacity:1 },
        onEachFeature: function(feature, layer){
          const postal = fipsToPostal[feature.id];
          const name = feature.properties.name;
          const tier = getTier(postal);
          const label = TIER_LABELS[tier];

          layer.bindTooltip(
            `<div style="font-weight:700;font-size:13px;margin-bottom:2px">${name} (${postal || '—'})</div>
             <div style="font-size:12px;opacity:.9">Status: <strong>${label}</strong></div>`,
            { sticky:true, direction:'auto', opacity:0.95 }
          );

          layer.on({
            mouseover: function(e){ const l=e.target; l.setStyle({weight:2.2,color:'#000000'}); l.bringToFront(); },
            mouseout:  function(e){ outlineLayer.resetStyle(e.target); }
          });
        }
      }).addTo(map);
    });
  </script>
</body>
</html>
